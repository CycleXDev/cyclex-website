<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (optional, same as main site) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BXDFXJWCNQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BXDFXJWCNQ');
  </script>

  <link rel="icon" href="/logo.png">
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/logo.png">
  <link rel="apple-touch-icon" href="/logo.png">

  <meta charset="UTF-8" />
  <title>CycleX ‚Äì Security Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg-main: #05060a;
      --bg-gradient-start: #05060a;
      --bg-gradient-mid: #1a0d3a;
      --bg-gradient-end: #003a4c;

      --text-main: #f4f6ff;
      --text-muted: rgba(244, 246, 255, 0.7);

      --accent-cyan: #00e5ff;
      --accent-green: #5dffb2;
      --accent-purple: #7c5cff;

      --card-bg: rgba(255, 255, 255, 0.06);
      --border-subtle: rgba(255, 255, 255, 0.12);

      --shadow-soft: 0 30px 90px rgba(0, 0, 0, 0.75);
      --radius-xl: 24px;
      --transition-fast: 0.18s ease-out;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(124, 92, 255, 0.35) 0%, transparent 45%),
        radial-gradient(circle at top right, rgba(0, 229, 255, 0.35) 0%, transparent 45%),
        radial-gradient(circle at bottom, rgba(0, 58, 76, 0.55) 0%, transparent 55%),
        linear-gradient(160deg, var(--bg-gradient-start), var(--bg-gradient-mid), var(--bg-gradient-end));
      color: var(--text-main);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      animation: fadeBody 0.7s ease-out forwards;
      opacity: 1;
    }

    @keyframes fadeBody { from { opacity: 0; } to { opacity: 1; } }

    a { color: inherit; text-decoration: none; }

    .page-shell { max-width: 1160px; margin: 0 auto; padding: 32px 20px 64px; }

    /* top bar */
    .top-bar {
      position: sticky;
      top: 14px;
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 18px;
      margin-bottom: 26px;
      border-radius: 999px;
      background: rgba(8, 10, 22, 0.55);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border: 1px solid rgba(255, 255, 255, 0.14);
      box-shadow: 0 20px 70px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.06);
    }

    .brand { display: flex; align-items: center; gap: 10px; }
    .brand-logo {
      width: 44px; height: 44px; border-radius: 16px; object-fit: contain;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.8);
    }
    .brand-text { display: flex; flex-direction: column; gap: 2px; }
    .brand-title { font-weight: 700; letter-spacing: 0.05em; font-size: 18px; text-transform: uppercase; }
    .brand-sub { font-size: 11px; text-transform: uppercase; letter-spacing: 0.16em; color: var(--text-muted); }

    .lang-switch {
      display: inline-flex;
      align-items: center;
      padding: 4px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.16);
      box-shadow: 0 12px 36px rgba(0, 0, 0, 0.55);
      gap: 2px;
    }

    .lang-btn {
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 11px;
      padding: 5px 8px;
      border-radius: 999px;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast);
    }
    .lang-btn.active { background: rgba(0, 229, 255, 0.14); color: var(--accent-cyan); }

    body.lang-switching { animation: langFade 0.3s ease-out; }
    @keyframes langFade { from { opacity: 0.4; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

    /* hero */
    .hero {
      text-align: center;
      max-width: 920px;
      margin: 0 auto 22px auto;
      animation: fadeUp 0.8s ease-out forwards;
    }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(14px); } to { opacity: 1; transform: translateY(0); } }

    .hero-kicker { font-size: 13px; letter-spacing: 0.16em; text-transform: uppercase; color: var(--accent-cyan); margin-bottom: 14px; }
    .hero-title { font-size: clamp(40px, 5vw, 60px); line-height: 1.05; font-weight: 800; margin-bottom: 14px; letter-spacing: -0.02em; }
    .hero-subtitle { max-width: 720px; margin: 0 auto 18px auto; font-size: 16px; line-height: 1.5; color: var(--text-muted); }

    .hero-actions {
      display: flex; justify-content: center; flex-wrap: wrap; gap: 14px; margin-bottom: 10px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 13px 26px;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-cyan), #7df2ff);
      color: #020308;
      box-shadow: 0 14px 40px rgba(0, 229, 255, 0.4);
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 18px 60px rgba(0, 229, 255, 0.6); }

    .btn-secondary {
      background: linear-gradient(135deg, var(--accent-green), #b9ffcf);
      color: #020308;
      box-shadow: 0 14px 40px rgba(0, 230, 118, 0.4);
    }
    .btn-secondary:hover { transform: translateY(-1px); box-shadow: 0 18px 60px rgba(0, 230, 118, 0.7); }

    .btn-ghost {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.16);
      color: var(--text-main);
      box-shadow: 0 12px 34px rgba(0,0,0,0.45);
    }
    .btn-ghost:hover { transform: translateY(-1px); border-color: rgba(0,229,255,0.26); }

    .section {
      margin-bottom: 18px;
      padding: 28px 22px;
      border-radius: var(--radius-xl);
      background: rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: 0 28px 80px rgba(0, 0, 0, 0.65), inset 0 1px 0 rgba(255, 255, 255, 0.05);
      text-align: left;
    }

    .section-head { text-align: center; margin-bottom: 14px; }
    .section-kicker { font-size: 12px; letter-spacing: 0.16em; text-transform: uppercase; color: var(--accent-purple); margin-bottom: 10px; }
    .section-title { font-size: 30px; font-weight: 800; margin-bottom: 8px; }
    .section-body { max-width: 900px; margin: 0 auto; font-size: 14px; line-height: 1.6; color: var(--text-muted); }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-top: 14px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; margin-top: 14px; }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      border: 1px solid var(--border-subtle);
      padding: 16px;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(18px);
      min-width: 0;
    }

    .card h3 { font-size: 15px; letter-spacing: 0.02em; margin-bottom: 8px; color: var(--text-main); }
    .muted { color: var(--text-muted); font-size: 13px; line-height: 1.45; }

    .field { margin-top: 10px; }
    .label { font-size: 12px; letter-spacing: 0.08em; text-transform: uppercase; color: rgba(244,246,255,0.75); margin-bottom: 6px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }

    input, textarea, select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(5, 7, 18, 0.9);
      color: var(--text-main);
      font-size: 13px;
      outline: none;
    }

    textarea { border-radius: 18px; min-height: 92px; resize: vertical; padding: 12px 12px; }

    input:focus, textarea:focus, select:focus { border-color: var(--accent-cyan); }

    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      color: var(--text-muted);
      white-space: nowrap;
    }

    .status {
      margin-top: 10px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.04);
      color: var(--text-main);
      line-height: 1.5;
      font-size: 13px;
      display: none;
    }

    .status.ok   { display:block; background: rgba(0, 230, 118, 0.10); border-color: rgba(0,230,118,0.35); color: #78ffbf; }
    .status.warn { display:block; background: rgba(255, 193, 7, 0.10); border-color: rgba(255,193,7,0.35); color: #ffd166; }
    .status.bad  { display:block; background: rgba(220, 53, 69, 0.10); border-color: rgba(220,53,69,0.35); color: #ff7a8a; }
    .status.info { display:block; background: rgba(0, 229, 255, 0.10); border-color: rgba(0,229,255,0.30); color: #7df2ff; }

    .small { font-size: 12px; color: var(--text-muted); line-height: 1.45; }

    .table {
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 18px;
      overflow: hidden;
    }
    .trow {
      display: grid;
      grid-template-columns: 1.3fr 1.1fr 0.9fr 0.9fr;
      gap: 10px;
      padding: 10px 12px;
      border-top: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      align-items: center;
      font-size: 13px;
    }
    .trow.head { border-top: none; background: rgba(255,255,255,0.05); font-size: 12px; letter-spacing: 0.08em; text-transform: uppercase; color: rgba(244,246,255,0.75); }
    .trow .cell { min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    .footer {
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      margin-top: 28px;
      padding-top: 16px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-size: 12px;
      color: var(--text-muted);
    }
    .footer-tagline { color: var(--accent-cyan); font-weight: 500; }

    @media (max-width: 980px) {
      .grid-2, .grid-3 { grid-template-columns: 1fr; }
      .trow { grid-template-columns: 1.2fr 1fr 0.9fr; }
      .trow .hide-sm { display: none; }
    }
    /* ===== SafeSwap Gate V2 additions ===== */
.toggle {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.05);
  color: rgba(244,246,255,0.86);
  font-size: 12px;
  user-select: none;
}
.toggle input { width: 16px; height: 16px; }

.ssrow {
  display: grid;
  grid-template-columns: 1.1fr 0.7fr 1.4fr 0.9fr 0.7fr;
  gap: 10px;
  padding: 10px 12px;
  border-top: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.03);
  align-items: center;
  font-size: 13px;
}
.ssrow.head {
  border-top: none;
  background: rgba(255,255,255,0.05);
  font-size: 12px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: rgba(244,246,255,0.75);
}
.ssrow .cell { min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
@media (max-width: 980px) {
  .ssrow { grid-template-columns: 1.2fr 0.8fr 1.2fr 0.8fr; }
  .ssrow .hide-sm2 { display: none; }
}

  </style>
</head>

<body>
  <div class="page-shell">
    <header class="top-bar">
      <a class="brand" href="/" title="Back to CycleX">
        <img src="/logo.png" alt="CycleX logo" class="brand-logo" />
        <div class="brand-text">
          <div class="brand-title">CYCLEX</div>
          <div class="brand-sub" data-i18n="brand_sub">On-Chain Security & Rewards</div>
        </div>
      </a>

      <div class="lang-switch" aria-label="Language selector">
        <button class="lang-btn active" data-lang="en">üá∫üá∏ EN</button>
        <button class="lang-btn" data-lang="zh">üá®üá≥ ‰∏≠Êñá</button>
        <button class="lang-btn" data-lang="ar">üá∏üá¶ ÿπÿ±ÿ®Ÿä</button>
        <button class="lang-btn" data-lang="ru">üá∑üá∫ RU</button>
      </div>
    </header>

    <main>
      <section class="hero">
        <div class="hero-kicker" data-i18n="hero_kicker">Security Hub</div>
        <h1 class="hero-title" data-i18n="hero_title">CycleX Security Tools</h1>
        <p class="hero-subtitle" data-i18n="hero_subtitle">
          A lightweight, client-side toolkit for safer swaps, approvals hygiene, DEX redirects, and RPC health checks.
        </p>

        <div class="hero-actions">
          <a class="btn btn-primary" href="/" data-i18n="btn_back">Back to Site</a>
          <button class="btn btn-secondary" id="btn-connect" data-i18n="btn_connect">Connect Wallet (optional)</button>
          <button class="btn btn-ghost" id="btn-run-all" data-i18n="btn_run_all">Run Quick Scan</button>
        </div>

        <div class="small" style="margin-top:10px" data-i18n="hero_note">
          Note: These checks are informational and do not guarantee safety. Always verify independently.
        </div>
      </section>

      <!-- 1) SafeSwap Gate -->
<section class="section" id="safeswap">
  <div class="section-head">
    <div class="section-kicker" data-i18n="ss_kicker">SafeSwap Gate</div>
    <div class="section-title" data-i18n="ss_title">Check token basics before you swap</div>
    <div class="section-body" data-i18n="ss_sub">
      Enter a token address on BSC. We‚Äôll read on-chain metadata, owner/proxy hints, and scan liquidity across multiple DEX routers ‚Äî then generate a share link.
    </div>
  </div>

  <div class="grid-2">
    <div class="card">
      <h3 data-i18n="ss_input_title">Token Address</h3>

      <div class="field">
        <div class="label" data-i18n="ss_token_label">Token contract (BSC)</div>
        <input id="ss-token" class="mono" placeholder="0x..." />
        <div class="small" style="margin-top:8px" data-i18n="ss_tip">
          Tip: You can open this page with <span class="mono">?token=0x...</span> and it will auto-run.
        </div>
      </div>

      <div class="field">
        <div class="label" data-i18n="ss_actions_label">Actions</div>
        <div class="row">
          <button class="btn btn-primary" id="ss-scan" data-i18n="ss_scan">Scan</button>
          <button class="btn btn-ghost" id="ss-share" data-i18n="ss_share">Copy Share Link</button>
          <button class="btn btn-ghost" id="ss-json" data-i18n="ss_json">Copy JSON Report</button>
          <a class="btn btn-ghost" id="ss-bsc" href="#" target="_blank" rel="noopener">BscScan</a>
        </div>
      </div>

      <div class="field">
        <div class="row" style="justify-content:space-between">
          <label class="toggle" title="When enabled, missing liquidity becomes a RED signal (production mode).">
            <input type="checkbox" id="ss-require" />
            <span data-i18n="ss_require_label">Require liquidity (production)</span>
          </label>

          <div class="pill">
            <span>BNB/USD:</span> <span id="ss-bnbusd" class="mono">‚Äî</span>
          </div>
        </div>

        <div class="small" style="margin-top:8px" data-i18n="ss_require_tip">
          If disabled: ‚Äúno pair found‚Äù may simply mean ‚Äúnot listed yet‚Äù.
        </div>
      </div>

      <div id="ss-status" class="status info"></div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <h3 data-i18n="ss_results_title" style="margin:0;">Results</h3>
        <div class="pill"><b>Score:</b> <span id="ss-score" class="mono">‚Äî</span></div>
      </div>

      <div class="small" data-i18n="ss_results_hint" style="margin-top:8px">
        We score signals as Green / Yellow / Red. This is not a honeypot guarantee ‚Äî just solid on-chain hygiene checks.
      </div>

      <div id="ss-out" class="status info" style="display:block; margin-top:12px;">
        <strong>Ready.</strong><br>
        Paste a token address and click <b>Scan</b>.
      </div>

      <div class="table" id="ss-dex-table" style="margin-top:12px; display:none;">
        <div class="ssrow head">
          <div class="cell">DEX</div>
          <div class="cell">Pair</div>
          <div class="cell">Best Pair</div>
          <div class="cell">Est. Liquidity</div>
          <div class="cell hide-sm2">LP Burn</div>
        </div>
      </div>

      <div class="small" style="margin-top:12px;"><b>Open swap:</b></div>
      <div class="row" id="ss-dex-buttons" style="margin-top:10px;"></div>
    </div>
  </div>
</section>


      <!-- 2) Approvals Guardian -->
      <section class="section" id="approvals">
        <div class="section-head">
          <div class="section-kicker" data-i18n="ap_kicker">Approvals Guardian</div>
          <div class="section-title" data-i18n="ap_title">Check and revoke ERC-20 allowances</div>
          <div class="section-body" data-i18n="ap_sub">
            This tool is targeted: you provide token(s) and spender. We read <span class="mono">allowance(owner, spender)</span> and can revoke by sending <span class="mono">approve(spender, 0)</span>.
          </div>
        </div>

        <div class="grid-2">
          <div class="card">
            <h3 data-i18n="ap_owner">Owner wallet</h3>
            <div class="row" style="justify-content:space-between">
              <div class="pill"><span data-i18n="ap_connected">Connected:</span> <span id="ap-address" class="mono">‚Äî</span></div>
              <button class="btn btn-secondary" id="ap-connect" data-i18n="ap_connect">Connect / Refresh</button>
            </div>

            <div class="field">
              <div class="label" data-i18n="ap_spender_label">Spender</div>
              <div class="row">
                <select id="ap-spender-preset">
                  <option value="pcs_router">PancakeSwap Router (V2)</option>
                  <option value="custom">Custom‚Ä¶</option>
                </select>
                <input id="ap-spender" class="mono" placeholder="0x spender..." />
              </div>
              <div class="small" style="margin-top:8px" data-i18n="ap_spender_tip">
                If you‚Äôre unsure: start with PancakeSwap Router preset.
              </div>
            </div>

            <div class="field">
              <div class="label" data-i18n="ap_tokens_label">Token list (one per line)</div>
              <textarea id="ap-tokens" class="mono" placeholder="0x...\n0x...\n0x..."></textarea>
            </div>

            <div class="field">
              <div class="row">
                <button class="btn btn-primary" id="ap-check" data-i18n="ap_check">Check Allowances</button>
                <button class="btn btn-ghost" id="ap-revoke-all" data-i18n="ap_revoke_all">Revoke All (non-zero)</button>
              </div>
            </div>

            <div id="ap-status" class="status info"></div>
          </div>

          <div class="card">
            <h3 data-i18n="ap_results">Allowances</h3>
            <div class="small" data-i18n="ap_results_hint">
              If allowance is ‚Äúinfinite‚Äù, revoke is recommended unless you fully trust the spender.
            </div>

            <div id="ap-table" class="table" style="margin-top:12px;">
              <div class="trow head">
                <div class="cell">Token</div>
                <div class="cell">Allowance</div>
                <div class="cell hide-sm">Symbol</div>
                <div class="cell">Action</div>
              </div>
              <div class="trow">
                <div class="cell muted">‚Äî</div>
                <div class="cell muted">‚Äî</div>
                <div class="cell muted hide-sm">‚Äî</div>
                <div class="cell muted">‚Äî</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 3) DEX Guard Bookmarklet -->
      <section class="section" id="bookmarklet">
        <div class="section-head">
          <div class="section-kicker" data-i18n="bm_kicker">DEX Guard</div>
          <div class="section-title" data-i18n="bm_title">Bookmarklet redirect to your security page</div>
          <div class="section-body" data-i18n="bm_sub">
            Save a bookmark that extracts token params from PancakeSwap pages and opens this Security Hub with <span class="mono">?token=</span>.
          </div>
        </div>

        <div class="grid-2">
          <div class="card">
            <h3 data-i18n="bm_drag">Drag to bookmarks bar</h3>
            <div class="small" data-i18n="bm_drag_tip">
              On desktop: drag this button into your bookmarks bar.
            </div>

            <div class="field">
              <a id="bm-link" class="btn btn-primary" href="#">DEX Guard ‚Üí CycleX Scan</a>
            </div>

            <div class="small" style="margin-top:10px" data-i18n="bm_note">
              Works best on PancakeSwap where URLs include <span class="mono">outputCurrency</span>.
            </div>
          </div>

          <div class="card">
            <h3 data-i18n="bm_code">Bookmarklet code</h3>
            <div class="small" data-i18n="bm_code_tip">If your browser blocks drag-drop, create a bookmark and paste this into the URL field:</div>
            <textarea id="bm-code" class="mono" readonly></textarea>
          </div>
        </div>
      </section>

      <!-- 4) RPC Checker -->
      <section class="section" id="rpc">
        <div class="section-head">
          <div class="section-kicker" data-i18n="rpc_kicker">RPC Checker</div>
          <div class="section-title" data-i18n="rpc_title">Find the fastest working BSC RPC</div>
          <div class="section-body" data-i18n="rpc_sub">
            We measure response time using <span class="mono">eth_blockNumber</span> via ethers. Fastest result is highlighted.
          </div>
        </div>

        <div class="grid-2">
          <div class="card">
            <h3 data-i18n="rpc_list">Endpoints</h3>

            <div class="field">
              <div class="label" data-i18n="rpc_custom_label">Optional custom RPC</div>
              <input id="rpc-custom" class="mono" placeholder="https://..." />
            </div>

            <div class="field">
              <div class="row">
                <button class="btn btn-primary" id="rpc-test" data-i18n="rpc_test">Test RPCs</button>
                <button class="btn btn-ghost" id="rpc-copy-best" data-i18n="rpc_copy_best">Copy Best RPC</button>
              </div>
            </div>

            <div id="rpc-status" class="status info"></div>
          </div>

          <div class="card">
            <h3 data-i18n="rpc_results">Results</h3>

            <div id="rpc-table" class="table">
              <div class="trow head">
                <div class="cell">RPC</div>
                <div class="cell">Latency</div>
                <div class="cell hide-sm">Block</div>
                <div class="cell">Status</div>
              </div>
            </div>

            <div class="small" style="margin-top:10px" data-i18n="rpc_tip">
              Tip: If one RPC fails due to CORS/timeout, try another ‚Äî we auto-fallback in CycleX anyway.
            </div>
          </div>
        </div>
      </section>

      <footer class="footer">
        <div data-i18n="footer_left">
          CycleX Security Hub runs client-side and reads public on-chain data.
        </div>
        <div class="footer-tagline" data-i18n="footer_tagline">
          Verify twice. Connect only when you trust the page.
        </div>
      </footer>
    </main>
  </div>

  <!-- Load ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.1/dist/ethers.umd.min.js"></script>

  <script>
  // ====== i18n (minimal for this page) ======
  const translations = {
    en: {
      brand_sub: "On-Chain Security & Rewards",
      hero_kicker: "Security Hub",
      hero_title: "CycleX Security Tools",
      hero_subtitle: "A lightweight, client-side toolkit for safer swaps, approvals hygiene, DEX redirects, and RPC health checks.",
      btn_back: "Back to Site",
      btn_connect: "Connect Wallet (optional)",
      btn_run_all: "Run Quick Scan",
      hero_note: "Note: These checks are informational and do not guarantee safety. Always verify independently.",

      ss_kicker: "SafeSwap Gate",
      ss_title: "Check token basics before you swap",
      ss_sub: "Enter a token address on BSC. We‚Äôll read on-chain metadata, owner/proxy hints, and scan liquidity across multiple DEX routers ‚Äî then generate a share link.",
      ss_input_title: "Token Address",
      ss_token_label: "Token contract (BSC)",
      ss_tip: "Tip: You can open this page with ?token=0x... and it will auto-run.",
      ss_actions_label: "Actions",
      ss_scan: "Scan",
      ss_share: "Copy Share Link",
      ss_json: "Copy JSON Report",
      ss_require_label: "Require liquidity (production)",
      ss_require_tip: "If disabled: ‚Äúno pair found‚Äù may simply mean ‚Äúnot listed yet‚Äù.",
      ss_results_title: "Results",
      ss_results_hint: "We score signals as Green / Yellow / Red. This is not a honeypot guarantee ‚Äî just solid on-chain hygiene checks.",

      ap_kicker: "Approvals Guardian",
      ap_title: "Check and revoke ERC-20 allowances",
      ap_sub: "This tool is targeted: you provide token(s) and spender. We read allowance(owner, spender) and can revoke by sending approve(spender, 0).",
      ap_owner: "Owner wallet",
      ap_connected: "Connected:",
      ap_connect: "Connect / Refresh",
      ap_spender_label: "Spender",
      ap_spender_tip: "If you‚Äôre unsure: start with PancakeSwap Router preset.",
      ap_tokens_label: "Token list (one per line)",
      ap_check: "Check Allowances",
      ap_revoke_all: "Revoke All (non-zero)",
      ap_results: "Allowances",
      ap_results_hint: "If allowance is ‚Äúinfinite‚Äù, revoke is recommended unless you fully trust the spender.",

      bm_kicker: "DEX Guard",
      bm_title: "Bookmarklet redirect to your security page",
      bm_sub: "Save a bookmark that extracts token params from DEX pages and opens this Security Hub with tokenIn/tokenOut.",
      bm_drag: "Drag to bookmarks bar",
      bm_drag_tip: "On desktop: drag this button into your bookmarks bar.",
      bm_note: "Works best when the DEX URL includes inputCurrency/outputCurrency.",
      bm_code: "Bookmarklet code",
      bm_code_tip: "If your browser blocks drag-drop, create a bookmark and paste this into the URL field:",

      rpc_kicker: "RPC Checker",
      rpc_title: "Find the fastest working BSC RPC",
      rpc_sub: "We measure response time using eth_blockNumber via ethers. Fastest result is highlighted.",
      rpc_list: "Endpoints",
      rpc_custom_label: "Optional custom RPC",
      rpc_test: "Test RPCs",
      rpc_copy_best: "Copy Best RPC",
      rpc_results: "Results",
      rpc_tip: "Tip: If one RPC fails due to CORS/timeout, try another ‚Äî we auto-fallback in CycleX anyway.",

      footer_left: "CycleX Security Hub runs client-side and reads public on-chain data.",
      footer_tagline: "Verify twice. Connect only when you trust the page."
    },

    zh: {
      brand_sub: "Èìæ‰∏äÂÆâÂÖ®‰∏éÂ•ñÂä±Êú∫Âà∂",
      hero_kicker: "ÂÆâÂÖ®‰∏≠ÂøÉ",
      hero_title: "CycleX ÂÆâÂÖ®Â∑•ÂÖ∑",
      hero_subtitle: "ËΩªÈáèÁ∫ßÂÆ¢Êà∑Á´ØÂ∑•ÂÖ∑ÔºöÊç¢Â∏ÅÂâçÊ£ÄÊü•„ÄÅÊéàÊùÉÁÆ°ÁêÜ„ÄÅDEX Ë∑≥ËΩ¨‰∏é RPC ‰ΩìÊ£Ä„ÄÇ",
      btn_back: "ËøîÂõûÁΩëÁ´ô",
      btn_connect: "ËøûÊé•Èí±ÂåÖÔºàÂèØÈÄâÔºâ",
      btn_run_all: "Âø´ÈÄüÊâ´Êèè",
      hero_note: "ÊèêÁ§∫ÔºöËøô‰∫õÊ£ÄÊü•‰ªÖ‰æõÂèÇËÄÉÔºå‰∏ç‰øùËØÅÂÆâÂÖ®ÔºåËØ∑Ëá™Ë°å‰∫åÊ¨°È™åËØÅ„ÄÇ",

      ss_kicker: "SafeSwap Gate",
      ss_title: "Êç¢Â∏ÅÂâçÂÖàÂÅöÂü∫Á°ÄÊ£ÄÊü•",
      ss_sub: "ËæìÂÖ• BSC ‰ª£Â∏ÅÂú∞ÂùÄÔºåËØªÂèñÈìæ‰∏ä‰ø°ÊÅØ„ÄÅowner/proxy Á∫øÁ¥¢ÔºåÂπ∂Âú®Â§ö‰∏™ DEX Êâ´ÊèèÊµÅÂä®ÊÄßÂêéÁîüÊàêÂàÜ‰∫´ÈìæÊé•„ÄÇ",
      ss_input_title: "‰ª£Â∏ÅÂú∞ÂùÄ",
      ss_token_label: "‰ª£Â∏ÅÂêàÁ∫¶ÔºàBSCÔºâ",
      ss_tip: "ÊèêÁ§∫ÔºöÂèØ‰ª•Áî® ?token=0x... ÊâìÂºÄÊú¨È°µÂπ∂Ëá™Âä®Êâ´Êèè„ÄÇ",
      ss_actions_label: "Êìç‰Ωú",
      ss_scan: "Êâ´Êèè",
      ss_share: "Â§çÂà∂ÂàÜ‰∫´ÈìæÊé•",
      ss_json: "Â§çÂà∂ JSON Êä•Âëä",
      ss_require_label: "Âº∫Âà∂Ë¶ÅÊ±ÇÊúâÊµÅÂä®ÊÄßÔºàÁîü‰∫ßÔºâ",
      ss_require_tip: "ÂÖ≥Èó≠Êó∂ÔºöÊ≤°Êúâ‰∫§ÊòìÂØπ‰πüÂèØËÉΩÂè™ÊòØËøòÊú™‰∏äÁ∫ø„ÄÇ",
      ss_results_title: "ÁªìÊûú",
      ss_results_hint: "Áî®Áªø/ÈªÑ/Á∫¢‰ø°Âè∑ËØÑÂàÜ„ÄÇËøô‰∏çÊòØËúúÁΩê‰øùËØÅÔºåÂè™ÊòØÈìæ‰∏äÂü∫Á°ÄÂÆâÂÖ®Ê£ÄÊü•„ÄÇ",

      ap_kicker: "ÊéàÊùÉÂÆàÂç´",
      ap_title: "Ê£ÄÊü•Âπ∂Êí§ÈîÄ ERC-20 ÊéàÊùÉ",
      ap_sub: "ËøôÊòØ‚ÄúÂÆöÂêë‚ÄùÂ∑•ÂÖ∑Ôºö‰Ω†Êèê‰æõ‰ª£Â∏ÅÂíå spenderÔºåÊàë‰ª¨ËØªÂèñ allowanceÔºåÂπ∂ÂèØÈÄöËøá approve(spender, 0) Êí§ÈîÄ„ÄÇ",
      ap_owner: "Èí±ÂåÖÂú∞ÂùÄ",
      ap_connected: "Â∑≤ËøûÊé•Ôºö",
      ap_connect: "ËøûÊé• / Âà∑Êñ∞",
      ap_spender_label: "Spender",
      ap_spender_tip: "‰∏çÁ°ÆÂÆöÁöÑËØùÔºöÂÖàÈÄâ PancakeSwap Router È¢ÑËÆæ„ÄÇ",
      ap_tokens_label: "‰ª£Â∏ÅÂàóË°®ÔºàÊØèË°å‰∏Ä‰∏™Ôºâ",
      ap_check: "Ê£ÄÊü•ÊéàÊùÉ",
      ap_revoke_all: "Êí§ÈîÄÂÖ®ÈÉ®ÔºàÈùûÈõ∂Ôºâ",
      ap_results: "ÊéàÊùÉÁªìÊûú",
      ap_results_hint: "Ëã•ÊéàÊùÉ‰∏∫‚ÄúÊó†Èôê‚ÄùÔºåÈô§ÈùûÂÆåÂÖ®‰ø°‰ªªÔºåÂê¶ÂàôÂª∫ËÆÆÊí§ÈîÄ„ÄÇ",

      bm_kicker: "DEX Guard",
      bm_title: "‰π¶Á≠æËÑöÊú¨Ôºö‰ªé DEX ‰∏ÄÈîÆË∑≥ËΩ¨Êâ´Êèè",
      bm_sub: "‰øùÂ≠ò‰∏Ä‰∏™‰π¶Á≠æÔºåËá™Âä®ÊèêÂèñ tokenIn/tokenOut Âπ∂ÊâìÂºÄÊú¨È°µÊâ´Êèè„ÄÇ",
      bm_drag: "ÊãñÂà∞‰π¶Á≠æÊ†è",
      bm_drag_tip: "Ê°åÈù¢Á´ØÔºöÊääÊåâÈíÆÊãñÂà∞‰π¶Á≠æÊ†èÂç≥ÂèØ„ÄÇ",
      bm_note: "Âú® URL Âê´ inputCurrency/outputCurrency Êó∂ÊïàÊûúÊúÄÂ•Ω„ÄÇ",
      bm_code: "‰π¶Á≠æ‰ª£Á†Å",
      bm_code_tip: "Ëã•ÊµèËßàÂô®ÈòªÊ≠¢ÊãñÊãΩÔºåËØ∑ÂàõÂª∫‰π¶Á≠æÂπ∂Êää‰ª•‰∏ãÂÜÖÂÆπÁ≤òË¥¥Âà∞ URLÔºö",

      rpc_kicker: "RPC ‰ΩìÊ£Ä",
      rpc_title: "ÊâæÂá∫ÊúÄÂø´ÂèØÁî®ÁöÑ BSC RPC",
      rpc_sub: "ÈÄöËøá ethers Ë∞ÉÁî® eth_blockNumber ÊµãÈáèÂª∂ËøüÔºåÊúÄÂø´ÁöÑ‰ºöÈ´ò‰∫Æ„ÄÇ",
      rpc_list: "ËäÇÁÇπÂàóË°®",
      rpc_custom_label: "ÂèØÈÄâÔºöËá™ÂÆö‰πâ RPC",
      rpc_test: "ÊµãËØï RPC",
      rpc_copy_best: "Â§çÂà∂ÊúÄ‰Ω≥ RPC",
      rpc_results: "ÁªìÊûú",
      rpc_tip: "ÊèêÁ§∫ÔºöÂ¶ÇÊûúÊüê‰∏™ RPC Âõ† CORS/Ë∂ÖÊó∂Â§±Ë¥•ÔºåÊç¢‰∏Ä‰∏™Âç≥ÂèØÔºåÊàë‰ª¨‰πü‰ºöËá™Âä® fallback„ÄÇ",

      footer_left: "CycleX ÂÆâÂÖ®‰∏≠ÂøÉÂú®Êú¨Âú∞ËøêË°åÔºåËØªÂèñÂÖ¨ÂºÄÈìæ‰∏äÊï∞ÊçÆ„ÄÇ",
      footer_tagline: "Â§öÈ™åËØÅ‰∏ÄÊ¨°ÔºåÂè™Âú®‰Ω†‰ø°‰ªªÊó∂ËøûÊé•Èí±ÂåÖ„ÄÇ"
    },

    ar: {
      brand_sub: "ÿ£ŸÖŸÜ ŸàŸÖŸÉÿßŸÅÿ¢ÿ™ ÿπŸÑŸâ ÿßŸÑÿ≥ŸÑÿ≥ŸÑÿ©",
      hero_kicker: "ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ£ŸÖÿßŸÜ",
      hero_title: "ÿ£ÿØŸàÿßÿ™ ÿßŸÑÿ£ŸÖÿßŸÜ ŸÖŸÜ CycleX",
      hero_subtitle: "ÿ£ÿØŸàÿßÿ™ ÿÆŸÅŸäŸÅÿ© ÿπŸÑŸâ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠: ŸÅÿ≠ÿµ ŸÇÿ®ŸÑ ÿßŸÑÿ¥ÿ±ÿßÿ°ÿå ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿßŸÅŸÇÿßÿ™ÿå ÿ•ÿπÿßÿØÿ© ÿ™Ÿàÿ¨ŸäŸá DEXÿå ŸàŸÅÿ≠ÿµ RPC.",
      btn_back: "ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸàŸÇÿπ",
      btn_connect: "ÿßÿ™ÿµÿßŸÑ ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)",
      btn_run_all: "ŸÅÿ≠ÿµ ÿ≥ÿ±Ÿäÿπ",
      hero_note: "ŸÖŸÑÿßÿ≠ÿ∏ÿ©: Ÿáÿ∞Ÿá ÿßŸÑŸÅÿ≠Ÿàÿµÿßÿ™ ŸÖÿπŸÑŸàŸÖÿßÿ™Ÿäÿ© ŸàŸÑÿß ÿ™ÿ∂ŸÖŸÜ ÿßŸÑÿ£ŸÖÿßŸÜ. ÿ™ÿ≠ŸÇŸÇ ÿØÿßÿ¶ŸÖÿßŸã ÿ®ŸÜŸÅÿ≥ŸÉ.",

      ss_kicker: "SafeSwap Gate",
      ss_title: "ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ£ÿ≥ÿßÿ≥Ÿäÿßÿ™ ÿßŸÑÿ™ŸàŸÉŸÜ ŸÇÿ®ŸÑ ÿßŸÑŸÖÿ®ÿßÿØŸÑÿ©",
      ss_sub: "ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿ™ŸàŸÉŸÜ ÿπŸÑŸâ BSC: ŸÇÿ±ÿßÿ°ÿ© ÿ®ŸäÿßŸÜÿßÿ™ on-chainÿå ÿ•ÿ¥ÿßÿ±ÿßÿ™ owner/proxyÿå ŸàŸÅÿ≠ÿµ ÿßŸÑÿ≥ŸäŸàŸÑÿ© ÿπÿ®ÿ± ÿπÿØÿ© DEX.",
      ss_input_title: "ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ™ŸàŸÉŸÜ",
      ss_token_label: "ÿπŸÇÿØ ÿßŸÑÿ™ŸàŸÉŸÜ (BSC)",
      ss_tip: "ŸÜÿµŸäÿ≠ÿ©: ÿßŸÅÿ™ÿ≠ ÿßŸÑÿµŸÅÿ≠ÿ© ŸÖÿπ ?token=0x... Ÿàÿ≥Ÿäÿ®ÿØÿ£ ÿßŸÑŸÅÿ≠ÿµ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã.",
      ss_actions_label: "ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™",
      ss_scan: "ŸÅÿ≠ÿµ",
      ss_share: "ŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©",
      ss_json: "ŸÜÿ≥ÿÆ ÿ™ŸÇÿ±Ÿäÿ± JSON",
      ss_require_label: "ÿßÿ¥ÿ™ÿ±ÿßÿ∑ Ÿàÿ¨ŸàÿØ ÿ≥ŸäŸàŸÑÿ© (ÿ•ŸÜÿ™ÿßÿ¨)",
      ss_require_tip: "ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸèÿπÿ∑ŸëŸÑÿßŸã: ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ÿ≤Ÿàÿ¨ ŸÇÿØ ŸäÿπŸÜŸä ÿ£ŸÜŸá ÿ∫Ÿäÿ± ŸÖŸèÿØÿ±ÿ¨ ÿ®ÿπÿØ.",
      ss_results_title: "ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨",
      ss_results_hint: "ŸÜÿ≥ÿ™ÿÆÿØŸÖ ÿ•ÿ¥ÿßÿ±ÿßÿ™ ÿ£ÿÆÿ∂ÿ±/ÿ£ÿµŸÅÿ±/ÿ£ÿ≠ŸÖÿ±. Ÿáÿ∞ÿß ŸÑŸäÿ≥ ÿ∂ŸÖÿßŸÜÿßŸã ÿ∂ÿØ honeypot ‚Äî ŸÅŸÇÿ∑ ŸÅÿ≠Ÿàÿµÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ© ÿπŸÑŸâ ÿßŸÑÿ≥ŸÑÿ≥ŸÑÿ©.",

      ap_kicker: "ÿ≠ÿßÿ±ÿ≥ ÿßŸÑŸÖŸàÿßŸÅŸÇÿßÿ™",
      ap_title: "ŸÅÿ≠ÿµ Ÿàÿ•ŸÑÿ∫ÿßÿ° ÿ≥ŸÖÿßÿ≠Ÿäÿßÿ™ ERC-20",
      ap_sub: "ÿ£ÿØÿßÿ© ŸÖŸàÿ¨Ÿáÿ©: ÿ£ŸÜÿ™ ÿ™ŸèÿØÿÆŸÑ ÿßŸÑÿ™ŸàŸÉŸÜ/ÿßŸÑÿ™ŸàŸÉŸÜÿßÿ™ ŸàÿßŸÑŸÄ spender. ŸÜŸÇÿ±ÿ£ allowance ŸàŸäŸÖŸÉŸÜ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ° ÿπÿ®ÿ± approve(spender, 0).",
      ap_owner: "ŸÖÿ≠ŸÅÿ∏ÿ© ÿßŸÑŸÖÿßŸÑŸÉ",
      ap_connected: "ŸÖÿ™ÿµŸÑ:",
      ap_connect: "ÿßÿ™ÿµÿßŸÑ / ÿ™ÿ≠ÿØŸäÿ´",
      ap_spender_label: "Spender",
      ap_spender_tip: "ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖÿ™ÿ£ŸÉÿØÿßŸã: ÿßÿ®ÿØÿ£ ÿ®ŸÖŸèÿ≥ÿ®ŸÇ PancakeSwap Router.",
      ap_tokens_label: "ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ™ŸàŸÉŸÜÿßÿ™ (ŸÉŸÑ ÿ≥ÿ∑ÿ± ÿ™ŸàŸÉŸÜ)",
      ap_check: "ŸÅÿ≠ÿµ ÿßŸÑÿ≥ŸÖÿßÿ≠Ÿäÿßÿ™",
      ap_revoke_all: "ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÉŸÑ (ÿ∫Ÿäÿ± ÿµŸÅÿ±)",
      ap_results: "ÿßŸÑÿ≥ŸÖÿßÿ≠Ÿäÿßÿ™",
      ap_results_hint: "ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑÿ≥ŸÖÿßÿ≠Ÿäÿ© ‚ÄúŸÑÿß ŸÜŸáÿßÿ¶Ÿäÿ©‚Äùÿå ŸäŸàÿµŸâ ÿ®ÿßŸÑÿ•ŸÑÿ∫ÿßÿ° ÿ•ŸÑÿß ÿ•ÿ∞ÿß ŸÉŸÜÿ™ ÿ™ÿ´ŸÇ ÿ™ŸÖÿßŸÖÿßŸã ÿ®ÿßŸÑŸÄ spender.",

      bm_kicker: "DEX Guard",
      bm_title: "Bookmarklet ŸÑÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™Ÿàÿ¨ŸäŸá ŸÑŸÑŸÅÿ≠ÿµ",
      bm_sub: "ÿßÿ≠ŸÅÿ∏ Bookmark Ÿäÿ≥ÿ™ÿÆÿ±ÿ¨ tokenIn/tokenOut ŸàŸäŸÅÿ™ÿ≠ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ±ŸÉÿ≤ ŸÑŸÑŸÅÿ≠ÿµ.",
      bm_drag: "ÿßÿ≥ÿ≠ÿ® ÿ•ŸÑŸâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©",
      bm_drag_tip: "ÿπŸÑŸâ ÿ≥ÿ∑ÿ≠ ÿßŸÑŸÖŸÉÿ™ÿ®: ÿßÿ≥ÿ≠ÿ® ÿßŸÑÿ≤ÿ± ÿ•ŸÑŸâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©.",
      bm_note: "ŸäÿπŸÖŸÑ ÿ£ŸÅÿ∂ŸÑ ÿπŸÜÿØŸÖÿß Ÿäÿ≠ÿ™ŸàŸä ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿπŸÑŸâ inputCurrency/outputCurrency.",
      bm_code: "ŸÉŸàÿØ ÿßŸÑŸÄ Bookmarklet",
      bm_code_tip: "ÿ•ÿ∞ÿß ŸÖŸÜÿπ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ÿßŸÑÿ≥ÿ≠ÿ®ÿå ÿ£ŸÜÿ¥ÿ¶ Bookmark ŸàÿßŸÑÿµŸÇ Ÿáÿ∞ÿß ŸÅŸä ÿÆÿßŸÜÿ© URL:",

      rpc_kicker: "ŸÅÿ≠ÿµ RPC",
      rpc_title: "ÿßÿπÿ´ÿ± ÿπŸÑŸâ ÿ£ÿ≥ÿ±ÿπ RPC ŸäÿπŸÖŸÑ ÿπŸÑŸâ BSC",
      rpc_sub: "ŸÜŸÇŸäÿ≥ ÿ≤ŸÖŸÜ ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ÿπÿ®ÿ± ethers Ÿà eth_blockNumber. ÿßŸÑÿ£ÿ≥ÿ±ÿπ ÿ≥Ÿäÿ∏Ÿáÿ± ŸÖŸÖŸäÿ≤ÿßŸã.",
      rpc_list: "ÿßŸÑŸÜŸÇÿßÿ∑",
      rpc_custom_label: "ÿßÿÆÿ™Ÿäÿßÿ±Ÿä: RPC ŸÖÿÆÿµÿµ",
      rpc_test: "ÿßÿÆÿ™ÿ®ÿßÿ± RPC",
      rpc_copy_best: "ŸÜÿ≥ÿÆ ÿ£ŸÅÿ∂ŸÑ RPC",
      rpc_results: "ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨",
      rpc_tip: "ŸÜÿµŸäÿ≠ÿ©: ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ RPC ÿ®ÿ≥ÿ®ÿ® CORS/timeout ÿ¨ÿ±Ÿëÿ® ÿ∫Ÿäÿ±Ÿá ‚Äî ŸÑÿØŸäŸÜÿß fallback ÿ£Ÿäÿ∂ÿßŸã.",

      footer_left: "ŸÖÿ±ŸÉÿ≤ ÿ£ŸÖÿßŸÜ CycleX ŸäÿπŸÖŸÑ ÿπŸÑŸâ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸàŸäŸÇÿ±ÿ£ ÿ®ŸäÿßŸÜÿßÿ™ ÿπÿßŸÖÿ© ÿπŸÑŸâ ÿßŸÑÿ≥ŸÑÿ≥ŸÑÿ©.",
      footer_tagline: "ÿ™ÿ≠ŸÇŸÇ ŸÖÿ±ÿ™ŸäŸÜ. ŸÑÿß ÿ™ÿ™ÿµŸÑ ÿ•ŸÑÿß ÿ•ÿ∞ÿß ŸÉŸÜÿ™ ÿ™ÿ´ŸÇ ÿ®ÿßŸÑÿµŸÅÿ≠ÿ©."
    },

    ru: {
      brand_sub: "–û–Ω—á–µ–π–Ω-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è",
      hero_kicker: "–¶–µ–Ω—Ç—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
      hero_title: "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ CycleX",
      hero_subtitle: "–õ—ë–≥–∫–∏–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Å–≤–æ–ø–æ–º, –≥–∏–≥–∏–µ–Ω–∞ approvals, DEX-—Ä–µ–¥–∏—Ä–µ–∫—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ RPC.",
      btn_back: "–ù–∞–∑–∞–¥ –Ω–∞ —Å–∞–π—Ç",
      btn_connect: "–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
      btn_run_all: "–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞",
      hero_note: "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ—Å—è—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ.",

      ss_kicker: "SafeSwap Gate",
      ss_title: "–ü—Ä–æ–≤–µ—Ä—å —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ —Å–≤–æ–ø–æ–º",
      ss_sub: "–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å —Ç–æ–∫–µ–Ω–∞ –≤ BSC. –ú—ã –ø—Ä–æ—á–∏—Ç–∞–µ–º on-chain –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, owner/proxy –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∏–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º DEX ‚Äî –∏ —Å–¥–µ–ª–∞–µ–º —Å—Å—ã–ª–∫—É.",
      ss_input_title: "–ê–¥—Ä–µ—Å —Ç–æ–∫–µ–Ω–∞",
      ss_token_label: "–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ç–æ–∫–µ–Ω–∞ (BSC)",
      ss_tip: "–°–æ–≤–µ—Ç: –æ—Ç–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å ?token=0x... –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.",
      ss_actions_label: "–î–µ–π—Å—Ç–≤–∏—è",
      ss_scan: "–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å",
      ss_share: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É",
      ss_json: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON –æ—Ç—á—ë—Ç",
      ss_require_label: "–¢—Ä–µ–±–æ–≤–∞—Ç—å –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å (production)",
      ss_require_tip: "–ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–æ: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä—ã –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –µ—â—ë –Ω–µ –∑–∞–ª–∏—Å—Ç–∏–ª–∏.",
      ss_results_title: "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã",
      ss_results_hint: "–°–∏–≥–Ω–∞–ª—ã: –∑–µ–ª—ë–Ω—ã–π/–∂—ë–ª—Ç—ã–π/–∫—Ä–∞—Å–Ω—ã–π. –≠—Ç–æ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—è –æ—Ç honeypot ‚Äî —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ on-chain –ø—Ä–æ–≤–µ—Ä–∫–∏.",

      ap_kicker: "Approvals Guardian",
      ap_title: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–∑—ã–≤ ERC-20 —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π",
      ap_sub: "–¢–æ—á–µ—á–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: –≤—ã –∑–∞–¥–∞—ë—Ç–µ —Ç–æ–∫–µ–Ω—ã –∏ spender. –ú—ã —á–∏—Ç–∞–µ–º allowance –∏ –º–æ–∂–µ–º –æ—Ç–æ–∑–≤–∞—Ç—å —á–µ—Ä–µ–∑ approve(spender, 0).",
      ap_owner: "–ö–æ—à–µ–ª—ë–∫ –≤–ª–∞–¥–µ–ª—å—Ü–∞",
      ap_connected: "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ:",
      ap_connect: "–ü–æ–¥–∫–ª—é—á–∏—Ç—å / –æ–±–Ω–æ–≤–∏—Ç—å",
      ap_spender_label: "Spender",
      ap_spender_tip: "–ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã: –Ω–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–µ—Å–µ—Ç–∞ PancakeSwap Router.",
      ap_tokens_label: "–°–ø–∏—Å–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤ (–ø–æ –æ–¥–Ω–æ–º—É –≤ —Å—Ç—Ä–æ–∫–µ)",
      ap_check: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å allowance",
      ap_revoke_all: "–û—Ç–æ–∑–≤–∞—Ç—å –≤—Å–µ (–Ω–µ–Ω—É–ª–µ–≤—ã–µ)",
      ap_results: "Allowances",
      ap_results_hint: "–ï—Å–ª–∏ allowance ‚Äú–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π‚Äù, –æ—Ç–∑—ã–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –µ—Å–ª–∏ –≤—ã –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç–µ spender –Ω–∞ 100%.",

      bm_kicker: "DEX Guard",
      bm_title: "Bookmarklet: —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É",
      bm_sub: "–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∑–∞–∫–ª–∞–¥–∫—É, –∫–æ—Ç–æ—Ä–∞—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç tokenIn/tokenOut –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç —Ü–µ–Ω—Ç—Ä.",
      bm_drag: "–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å –∑–∞–∫–ª–∞–¥–æ–∫",
      bm_drag_tip: "–ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤ –ø–∞–Ω–µ–ª—å –∑–∞–∫–ª–∞–¥–æ–∫.",
      bm_note: "–õ—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ URL —Å–æ–¥–µ—Ä–∂–∏—Ç inputCurrency/outputCurrency.",
      bm_code: "–ö–æ–¥ bookmarklet",
      bm_code_tip: "–ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç drag&drop ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–ª–∞–¥–∫—É –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ –≤ –ø–æ–ª–µ URL:",

      rpc_kicker: "RPC Checker",
      rpc_title: "–ù–∞–π–¥–∏—Ç–µ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π RPC –¥–ª—è BSC",
      rpc_sub: "–ò–∑–º–µ—Ä—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É —á–µ—Ä–µ–∑ ethers –∏ eth_blockNumber. –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–¥—Å–≤–µ—á–µ–Ω.",
      rpc_list: "–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã",
      rpc_custom_label: "–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–≤–æ–π RPC",
      rpc_test: "–¢–µ—Å—Ç RPC",
      rpc_copy_best: "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª—É—á—à–∏–π RPC",
      rpc_results: "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã",
      rpc_tip: "–°–æ–≤–µ—Ç: –µ—Å–ª–∏ RPC –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ CORS/timeout ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π, —É –Ω–∞—Å —Ç–∞–∫–∂–µ –µ—Å—Ç—å fallback.",

      footer_left: "CycleX Security Hub —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —á–∏—Ç–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–µ on-chain –¥–∞–Ω–Ω—ã–µ.",
      footer_tagline: "–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–≤–∞–∂–¥—ã. –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ –∫–æ—à–µ–ª—ë–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–æ–≤–µ—Ä—è–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ."
    }
  };

  function setLanguage(lang) {
    const dict = translations[lang] || translations.en;

    document.body.classList.add("lang-switching");

    document.querySelectorAll("[data-i18n]").forEach((el) => {
      const key = el.getAttribute("data-i18n");
      if (dict[key]) el.innerHTML = dict[key];
    });

    document.querySelectorAll(".lang-btn").forEach((btn) => {
      btn.classList.toggle("active", btn.getAttribute("data-lang") === lang);
    });

    document.documentElement.dir = (lang === "ar") ? "rtl" : "ltr";

    setTimeout(() => document.body.classList.remove("lang-switching"), 250);
  }

  document.querySelectorAll(".lang-btn").forEach((btn) => {
    btn.addEventListener("click", () => setLanguage(btn.getAttribute("data-lang")));
  });

  setLanguage("en");

  // ====== Shared helpers ======
  const CX_DEBUG = false;
  function cxlog(...a){ if(CX_DEBUG) console.log(...a); }

  const RPCS_DEFAULT = [
    "https://bsc-dataseed.binance.org",
    "https://bsc-dataseed1.bnbchain.org",
    "https://bsc-dataseed2.bnbchain.org",
    "https://bsc-dataseed3.bnbchain.org",
    "https://bsc-dataseed1.defibit.io",
  ];

  // PancakeSwap V2 (BSC mainnet)
  const PCS_FACTORY = "0xca143ce32fe78f1f7019d7d551a6402fc5350c73";
  const PCS_ROUTER  = "0x10ED43C718714eb63d5aA57B78B54704E256024E";
  const WBNB        = "0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c";
  const USDT        = "0x55d398326f99059fF775485246999027B3197955";
  const USDC        = "0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d";
  const BUSD        = "0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56";
  const DEAD        = "0x000000000000000000000000000000000000dEaD";
  const ZERO        = "0x0000000000000000000000000000000000000000";

  // Chainlink BNB/USD feed on BSC (fallback exists even if oracle fails)
  const CHAINLINK_BNB_USD = "0x0567F2323251f0Aab15c8dFb1967E4e8A7D42aeE";

  // Multi-DEX V2 routers (scan best-effort; errors are handled per DEX)
  const SS_DEXES = [
    {
      key: "pancake",
      name: "PancakeSwap V2",
      router: PCS_ROUTER,
      swapBase: "https://pancakeswap.finance/swap"
    },
    {
      key: "apeswap",
      name: "ApeSwap",
      router: "0x8634B5534c29cBD1ceeDdfD30721b95BFf31202d",
      swapBase: "https://apeswap.finance/swap"
    },
    {
      key: "biswap",
      name: "BiSwap",
      router: "0xa35e952f117b8f4aaca0dffd783a47c25b3f8090",
      swapBase: "https://biswap.org/#/swap"
    },
    {
      key: "mdex",
      name: "MDEX",
      router: "0x302578786399a628ee8c250e74ee1da798d50442",
      swapBase: "https://bsc.mdex.com/#/swap"
    },
    {
      key: "bakery",
      name: "BakerySwap",
      router: "0x84D218921bABECED3B2349A63421DD3cC406BE2a",
      swapBase: "https://www.bakeryswap.org/#/swap"
    },
    {
      key: "babyswap",
      name: "BabySwap",
      router: "0x72bb67690e861eabd8daa0e8b6608ca28a806f5a",
      swapBase: "https://exchange.babyswap.finance/#/swap"
    }
  ];

  const SS_BASES = [
    { sym: "WBNB", addr: WBNB, stable: false },
    { sym: "USDT", addr: USDT, stable: true  },
    { sym: "USDC", addr: USDC, stable: true  },
    { sym: "BUSD", addr: BUSD, stable: true  },
  ];

  let _rpcProvider = null;
  let _rpcUrl = "";

  function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }
  function resetRpc(){ _rpcProvider = null; _rpcUrl = ""; }

  async function withTimeout(promise, ms, label){
    let t;
    const timeout = new Promise((_, rej) => {
      t = setTimeout(() => rej(new Error(`Timeout${label ? " ("+label+")" : ""}`)), ms);
    });
    try { return await Promise.race([promise, timeout]); }
    finally { clearTimeout(t); }
  }

  async function pickProvider(customList) {
    if (_rpcProvider) return _rpcProvider;

    const list = Array.isArray(customList) && customList.length ? customList : RPCS_DEFAULT;

    for (const url of list) {
      try {
        const p = new ethers.JsonRpcProvider(url);
        const bn = await withTimeout(p.getBlockNumber(), 7000, "getBlockNumber");
        const net = await withTimeout(p.getNetwork(), 7000, "getNetwork");
        if (Number(net.chainId) !== 56) throw new Error("Wrong chainId");

        _rpcProvider = p;
        _rpcUrl = url;
        cxlog("‚úÖ RPC:", url, "block:", bn);
        return p;
      } catch (e) {
        cxlog("‚ö†Ô∏è RPC fail:", url, e?.message || e);
      }
    }
    throw new Error("All RPCs failed");
  }

  function isHexAddr(x){ return typeof x === "string" && /^0x[0-9a-fA-F]{40}$/.test(x.trim()); }
  function toChecksum(x){ return ethers.getAddress(x.trim()); }

  async function copyText(text){
    try {
      await navigator.clipboard.writeText(text);
      return true;
    } catch {
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      return true;
    }
  }

  function setStatus(el, kind, html){
    el.className = "status " + (kind || "info");
    el.innerHTML = html || "";
    el.style.display = "block";
  }

  function fmtAddr(a){
    try {
      const x = toChecksum(a);
      return x.slice(0, 6) + "‚Ä¶" + x.slice(-4);
    } catch { return a; }
  }

  function escapeHtml(s){
    return String(s ?? "")
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  function fmtBigintUnits(v, decimals){
    try {
      const s = ethers.formatUnits(v, decimals);
      const [i, f=""] = s.split(".");
      const intWithCommas = i.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      const ff = f.slice(0, 6).replace(/0+$/, "");
      return intWithCommas + (ff ? "." + ff : "");
    } catch {
      return String(v);
    }
  }

  function fmtMoney(x){
    if (!Number.isFinite(x)) return "‚Äî";
    return "$" + x.toLocaleString(undefined, { maximumFractionDigits: 2 });
  }

  // ====== 1) SafeSwap Gate V2 ======
  const ERC20_ABI = [
    "function name() view returns (string)",
    "function symbol() view returns (string)",
    "function decimals() view returns (uint8)",
    "function totalSupply() view returns (uint256)",
    "function owner() view returns (address)",
    "function getOwner() view returns (address)",
    "function admin() view returns (address)",
  ];

  const ROUTER_ABI = [
    "function factory() view returns (address)"
  ];

  const FACTORY_ABI = [
    "function getPair(address tokenA, address tokenB) external view returns (address pair)"
  ];

  const PAIR_ABI = [
    "function token0() view returns (address)",
    "function token1() view returns (address)",
    "function getReserves() view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
    "function totalSupply() view returns (uint256)",
    "function balanceOf(address) view returns (uint256)"
  ];

  const CL_AGG_ABI = [
    "function decimals() view returns (uint8)",
    "function latestRoundData() view returns (uint80, int256, uint256, uint256, uint80)"
  ];

  const EIP1967_IMPL_SLOT = "0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc";

  let _ssLastReport = null;
  let _ssTokenIn = null;
  let _ssTokenOut = null;

  function ssSetScore(score){
    document.getElementById("ss-score").textContent = (score === null || score === undefined) ? "‚Äî" : String(score);
  }

  function ssSetBnbUsd(text){
    document.getElementById("ss-bnbusd").textContent = text || "‚Äî";
  }

  function ssDexTableReset(){
    const t = document.getElementById("ss-dex-table");
    t.style.display = "none";
    // keep header only
    t.innerHTML = `
      <div class="ssrow head">
        <div class="cell">DEX</div>
        <div class="cell">Pair</div>
        <div class="cell">Best Pair</div>
        <div class="cell">Est. Liquidity</div>
        <div class="cell hide-sm2">LP Burn</div>
      </div>
    `;
  }

  function ssDexTableShow(){
    document.getElementById("ss-dex-table").style.display = "block";
  }

  function buildSwapUrl(dex, tokenIn, tokenOut){
    // Use a unified template. Unknown params are ignored by most DEX UIs.
    const inA = tokenIn || WBNB;
    const outA = tokenOut;
    const base = dex.swapBase;

    // If the URL already has #/swap, add query after it; otherwise use standard query
    if (base.includes("#/swap")) {
      return base + `?inputCurrency=${encodeURIComponent(inA)}&outputCurrency=${encodeURIComponent(outA)}`;
    }
    return base + `?inputCurrency=${encodeURIComponent(inA)}&outputCurrency=${encodeURIComponent(outA)}`;
  }

  async function getProxyImpl(provider, addr){
    try{
      const raw = await withTimeout(provider.getStorage(addr, EIP1967_IMPL_SLOT), 7000, "getStorage");
      const impl = "0x" + raw.slice(26);
      if (/^0x0{40}$/i.test(impl)) return null;
      return toChecksum(impl);
    }catch{
      return null;
    }
  }

  async function tryReadOwner(provider, token){
    const c = new ethers.Contract(token, ERC20_ABI, provider);
    for (const fn of ["owner", "getOwner", "admin"]) {
      try{
        const o = await withTimeout(c[fn](), 7000, fn);
        if (o && isHexAddr(String(o))) return toChecksum(String(o));
      }catch{}
    }
    return null;
  }

  function isRenounced(owner){
    if(!owner) return false;
    const o = owner.toLowerCase();
    return o === ZERO.toLowerCase() || o === DEAD.toLowerCase();
  }

  async function getTokenDecimals(provider, token){
    try{
      const c = new ethers.Contract(token, ERC20_ABI, provider);
      return Number(await withTimeout(c.decimals(), 7000, "decimals"));
    }catch{
      return 18;
    }
  }

  async function getBaseDecimals(provider){
    const out = {};
    for (const b of SS_BASES) {
      out[b.addr.toLowerCase()] = 18;
      try{
        const c = new ethers.Contract(b.addr, ["function decimals() view returns (uint8)"], provider);
        out[b.addr.toLowerCase()] = Number(await withTimeout(c.decimals(), 7000, "baseDecimals"));
      }catch{}
    }
    return out;
  }

  async function getBnbUsdFromChainlink(provider){
    try{
      const agg = new ethers.Contract(CHAINLINK_BNB_USD, CL_AGG_ABI, provider);
      const dec = Number(await withTimeout(agg.decimals(), 7000, "cl_decimals"));
      const rd = await withTimeout(agg.latestRoundData(), 7000, "cl_latestRoundData");
      const ans = rd[1];
      if (typeof ans !== "bigint") return null;
      const price = Number(ans) / (10 ** dec);
      if (!Number.isFinite(price) || price <= 0) return null;
      return { price, source: "chainlink" };
    }catch{
      return null;
    }
  }

  async function getBnbUsdFromOnChain(provider){
    // fallback: compute BNB price using PancakeSwap V2 WBNB/stable pair reserves
    try{
      const factory = new ethers.Contract(PCS_FACTORY, FACTORY_ABI, provider);

      const stables = [USDT, USDC, BUSD];
      let best = null;

      for (const s of stables) {
        const pair = await withTimeout(factory.getPair(WBNB, s), 7000, "getPair");
        if (!pair || String(pair) === ZERO) continue;

        const p = new ethers.Contract(pair, PAIR_ABI, provider);
        const [t0, reserves] = await Promise.all([
          withTimeout(p.token0(), 7000, "token0"),
          withTimeout(p.getReserves(), 7000, "getReserves"),
        ]);

        const token0 = toChecksum(String(t0));
        const r0 = BigInt(reserves.reserve0 ?? reserves[0]);
        const r1 = BigInt(reserves.reserve1 ?? reserves[1]);

        let rWbnb = 0n, rStable = 0n;
        if (token0.toLowerCase() === WBNB.toLowerCase()){
          rWbnb = r0; rStable = r1;
        } else {
          rWbnb = r1; rStable = r0;
        }

        const wbnb = Number(ethers.formatUnits(rWbnb, 18));
        const stable = Number(ethers.formatUnits(rStable, 18));
        if (!Number.isFinite(wbnb) || !Number.isFinite(stable) || wbnb <= 0 || stable <= 0) continue;

        const price = stable / wbnb; // stable per 1 BNB ~ USD/BNB
        const depth = stable; // depth proxy
        if (!best || depth > best.depth) best = { price, source: "onchain", depth };
      }

      if (!best || !Number.isFinite(best.price) || best.price <= 0) return null;
      return { price: best.price, source: "onchain" };
    }catch{
      return null;
    }
  }

  async function getBnbUsd(provider){
    const cl = await getBnbUsdFromChainlink(provider);
    if (cl) return cl;
    const oc = await getBnbUsdFromOnChain(provider);
    if (oc) return oc;
    return null;
  }

  async function scanDex(provider, token, tokenDec, baseDecMap, dex, bnbUsd){
    const res = {
      dexKey: dex.key,
      dexName: dex.name,
      router: dex.router,
      found: false,
      bestBase: null,
      bestPair: null,
      bestLiquidityUsd: null,
      bestLiquidityNote: null,
      lpBurnPct: null,
      error: null,
    };

    try{
      const router = new ethers.Contract(dex.router, ROUTER_ABI, provider);
      const factoryAddr = await withTimeout(router.factory(), 9000, dex.name + " factory()");
      const factory = new ethers.Contract(factoryAddr, FACTORY_ABI, provider);

      let bestCandidate = null;

      for (const base of SS_BASES){
        const pairAddr = await withTimeout(factory.getPair(token, base.addr), 9000, dex.name + " getPair");
        const pair = String(pairAddr || "");
        if (!pair || pair === ZERO) continue;

        const p = new ethers.Contract(pair, PAIR_ABI, provider);
        const [t0, reserves] = await Promise.all([
          withTimeout(p.token0(), 9000, "token0"),
          withTimeout(p.getReserves(), 9000, "getReserves"),
        ]);

        const token0 = toChecksum(String(t0));
        const r0 = BigInt(reserves.reserve0 ?? reserves[0]);
        const r1 = BigInt(reserves.reserve1 ?? reserves[1]);

        let rBase = 0n;
        if (token0.toLowerCase() === base.addr.toLowerCase()) rBase = r0;
        else rBase = r1;

        const baseDec = baseDecMap[base.addr.toLowerCase()] ?? 18;
        const baseReserve = Number(ethers.formatUnits(rBase, baseDec));

        let liqUsd = null;
        let note = null;

        if (base.stable){
          liqUsd = 2 * baseReserve; // assume 1 USD per stable
          note = "stable";
        } else {
          if (bnbUsd && Number.isFinite(bnbUsd.price)) {
            liqUsd = 2 * baseReserve * bnbUsd.price;
            note = `WBNB√ó${bnbUsd.source}`;
          } else {
            liqUsd = null;
            note = "WBNB(no USD price)";
          }
        }

        const candidate = {
          pair: toChecksum(pair),
          baseSym: base.sym,
          baseReserve,
          liqUsd,
          note
        };

        if (!bestCandidate) bestCandidate = candidate;
        else {
          const a = (bestCandidate.liqUsd ?? (bestCandidate.baseSym === "WBNB" ? bestCandidate.baseReserve : 0));
          const b = (candidate.liqUsd ?? (candidate.baseSym === "WBNB" ? candidate.baseReserve : 0));
          if (b > a) bestCandidate = candidate;
        }
      }

      if (!bestCandidate){
        res.found = false;
        return res;
      }

      res.found = true;
      res.bestBase = bestCandidate.baseSym;
      res.bestPair = bestCandidate.pair;
      res.bestLiquidityUsd = bestCandidate.liqUsd;
      res.bestLiquidityNote = bestCandidate.note;

      // LP burn basic
      try{
        const lp = new ethers.Contract(bestCandidate.pair, PAIR_ABI, provider);
        const [ts, b0, bd] = await Promise.all([
          withTimeout(lp.totalSupply(), 9000, "lp_totalSupply"),
          withTimeout(lp.balanceOf(ZERO), 9000, "lp_balanceOf_zero"),
          withTimeout(lp.balanceOf(DEAD), 9000, "lp_balanceOf_dead"),
        ]);
        const total = BigInt(ts);
        const burned = BigInt(b0) + BigInt(bd);
        const pct = (total > 0n) ? (Number((burned * 10000n) / total) / 100) : 0;
        if (Number.isFinite(pct)) res.lpBurnPct = pct;
      }catch{}

      return res;

    }catch(e){
      res.error = (e?.message || e || "error").toString();
      return res;
    }
  }

  function ssRowHtml(r){
    const foundTag = r.found ? "‚úÖ" : "‚Äî";
    const bestPairShort = r.bestPair ? `${fmtAddr(r.bestPair)} (${r.bestBase})` : (r.error ? "Error" : "‚Äî");
    const liq = (r.bestLiquidityUsd !== null && r.bestLiquidityUsd !== undefined)
      ? fmtMoney(r.bestLiquidityUsd)
      : (r.found ? (r.bestLiquidityNote || "‚Äî") : "‚Äî");
    const burn = (typeof r.lpBurnPct === "number") ? (r.lpBurnPct.toFixed(2) + "%") : "‚Äî";

    return `
      <div class="ssrow">
        <div class="cell"><b>${escapeHtml(r.dexName)}</b></div>
        <div class="cell">${foundTag}</div>
        <div class="cell mono" title="${escapeHtml(r.bestPair || "")}">${escapeHtml(bestPairShort)}</div>
        <div class="cell">${escapeHtml(liq)}</div>
        <div class="cell hide-sm2">${escapeHtml(burn)}</div>
      </div>
    `;
  }

  function ssSetDexButtons(tokenIn, tokenOut, dexResults){
    const box = document.getElementById("ss-dex-buttons");
    box.innerHTML = "";

    // Always show Pancake (V3 link works too)
    for (const dex of SS_DEXES){
      const btn = document.createElement("a");
      btn.className = "btn btn-ghost";
      btn.target = "_blank";
      btn.rel = "noopener";
      btn.textContent = dex.name;

      const url = buildSwapUrl(dex, tokenIn, tokenOut);
      btn.href = url;

      // if dex has no pair found, still show (manual open)
      box.appendChild(btn);
    }
  }

  function ssBuildShareLink({ token, tokenIn, tokenOut, requireLiquidity }){
    const u = new URL(window.location.href);
    u.searchParams.set("token", token);
    if (tokenIn) u.searchParams.set("tokenIn", tokenIn);
    if (tokenOut) u.searchParams.set("tokenOut", tokenOut);
    if (requireLiquidity) u.searchParams.set("requireLiq", "1");
    else u.searchParams.delete("requireLiq");
    return u.toString();
  }

  async function ssCopyShare() {
    const status = document.getElementById("ss-status");
    const raw = (document.getElementById("ss-token").value || "").trim();
    if (!raw || !isHexAddr(raw)) {
      setStatus(status, "warn", "<strong>‚ö†Ô∏è Paste a valid token address first.</strong>");
      return;
    }
    const token = toChecksum(raw);
    const requireLiquidity = !!document.getElementById("ss-require").checked;

    const link = ssBuildShareLink({
      token,
      tokenIn: _ssTokenIn || null,
      tokenOut: token,
      requireLiquidity
    });

    await copyText(link);
    setStatus(status, "ok", `<strong>‚úÖ Share link copied.</strong><br><span class="mono">${escapeHtml(link)}</span>`);
  }

  async function ssCopyJson(){
    const status = document.getElementById("ss-status");
    if(!_ssLastReport){
      setStatus(status, "warn", "<strong>‚ö†Ô∏è No report yet.</strong><br>Run Scan first.");
      return;
    }
    const txt = JSON.stringify(_ssLastReport, null, 2);
    await copyText(txt);
    setStatus(status, "ok", "<strong>‚úÖ JSON report copied.</strong>");
  }

  async function ssScan() {
    const input = document.getElementById("ss-token");
    const out = document.getElementById("ss-out");
    const status = document.getElementById("ss-status");

    ssSetScore("‚Äî");
    ssSetBnbUsd("‚Äî");
    ssDexTableReset();
    document.getElementById("ss-dex-buttons").innerHTML = "";
    _ssLastReport = null;

    let addrRaw = (input.value || "").trim();
    if (!addrRaw) {
      setStatus(status, "warn", "<strong>‚ö†Ô∏è Missing token address.</strong><br>Paste a token and try again.");
      return;
    }
    if (!isHexAddr(addrRaw)) {
      setStatus(status, "bad", "<strong>‚ùå Invalid address format.</strong><br>Expected 0x + 40 hex chars.");
      return;
    }

    const token = toChecksum(addrRaw);
    _ssTokenOut = token;

    // external link
    const bsc = document.getElementById("ss-bsc");
    bsc.href = "https://bscscan.com/address/" + token;

    const requireLiquidity = !!document.getElementById("ss-require").checked;

    setStatus(status, "info", "<strong>‚è≥ Scanning‚Ä¶</strong><br>Reading metadata, proxy/owner, and multi-DEX liquidity.");
    setStatus(out, "info", "<strong>‚è≥ Working‚Ä¶</strong>");

    try {
      const provider = await pickProvider();

      // 0) contract code
      const code = await withTimeout(provider.getCode(token), 9000, "getCode");
      const isContract = code && code !== "0x";
      if (!isContract) {
        setStatus(out, "bad", `<strong>‚ùå Not a contract.</strong><br>${escapeHtml(token)} has no bytecode on BSC.`);
        setStatus(status, "bad", "<strong>‚ùå Scan finished:</strong> address is not a token contract.");
        return;
      }

      let score = 0;
      const signals = [];

      signals.push({ level:"good", text:"Contract bytecode found." });

      // 1) proxy hint
      const proxyImpl = await getProxyImpl(provider, token);
      if (proxyImpl) {
        score += 1;
        signals.push({ level:"warn", text:`Proxy pattern detected (EIP-1967). Impl: ${proxyImpl}` });
      } else {
        signals.push({ level:"good", text:"No EIP-1967 proxy slot detected." });
      }

      // 2) metadata
      const c = new ethers.Contract(token, ERC20_ABI, provider);
      let name = "‚Äî", symbol = "‚Äî", decimals = 18, supply = 0n;
      try { name = await withTimeout(c.name(), 7000, "name"); } catch { score += 1; signals.push({level:"warn", text:"Token name unreadable (non-standard)."}); }
      try { symbol = await withTimeout(c.symbol(), 7000, "symbol"); } catch { score += 1; signals.push({level:"warn", text:"Token symbol unreadable (non-standard)."}); }
      try { decimals = Number(await withTimeout(c.decimals(), 7000, "decimals")); } catch {}
      try { supply = BigInt(await withTimeout(c.totalSupply(), 7000, "totalSupply")); } catch { score += 1; signals.push({level:"warn", text:"Total supply unreadable (non-standard)."}); }

      // 3) owner
      const owner = await tryReadOwner(provider, token);
      if (!owner) {
        score += 1;
        signals.push({ level:"warn", text:"Owner not detectable (may be fine, but less transparent)." });
      } else if (isRenounced(owner)) {
        signals.push({ level:"good", text:`Owner looks renounced: ${owner}` });
      } else {
        score += 1;
        signals.push({ level:"warn", text:`Owner detected (not renounced): ${owner}` });
      }

      // 4) BNB/USD (oracle ‚Üí fallback)
      const bnbUsd = await getBnbUsd(provider);
      if (bnbUsd && Number.isFinite(bnbUsd.price)) {
        ssSetBnbUsd(bnbUsd.price.toFixed(4) + " (" + bnbUsd.source + ")");
        signals.push({ level:"good", text:`BNB/USD price loaded (${bnbUsd.source}).` });
      } else {
        ssSetBnbUsd("‚Äî");
        score += 1;
        signals.push({ level:"warn", text:"BNB/USD price not available (USD liquidity for WBNB pairs may be missing)." });
      }

      const tokenDec = decimals || await getTokenDecimals(provider, token);
      const baseDecMap = await getBaseDecimals(provider);

      // 5) multi-DEX scans
      const dexResults = [];
      for (const dex of SS_DEXES) {
        const r = await scanDex(provider, token, tokenDec, baseDecMap, dex, bnbUsd);
        dexResults.push(r);
      }

      const anyFound = dexResults.some(r => r.found);
      if (!anyFound) {
        if (requireLiquidity) {
          score += 4;
          signals.push({ level:"bad", text:"No DEX pair found across scanned routers (Require liquidity enabled)." });
        } else {
          score += 1;
          signals.push({ level:"warn", text:"No DEX pair found across scanned routers (may be not listed yet)." });
        }
      } else {
        signals.push({ level:"good", text:"At least one DEX pair found across scanned routers." });
      }

      // best liquidity thresholds (only when we have USD)
      const usdList = dexResults
        .filter(r => r.found && Number.isFinite(r.bestLiquidityUsd))
        .map(r => ({ dex: r.dexName, usd: r.bestLiquidityUsd }));

      if (usdList.length) {
        usdList.sort((a,b)=>b.usd-a.usd);
        const best = usdList[0];

        if (best.usd < 2000) {
          score += 3;
          signals.push({ level:"bad", text:`Very low estimated liquidity on best pair: ${fmtMoney(best.usd)} (${best.dex}).` });
        } else if (best.usd < 20000) {
          score += 1;
          signals.push({ level:"warn", text:`Low estimated liquidity on best pair: ${fmtMoney(best.usd)} (${best.dex}).` });
        } else {
          signals.push({ level:"good", text:`Best estimated liquidity looks decent: ${fmtMoney(best.usd)} (${best.dex}).` });
        }
      }

      // LP burn heuristic (optional mild scoring)
      for (const r of dexResults) {
        if (typeof r.lpBurnPct === "number" && r.found) {
          if (r.lpBurnPct < 20) score += 1;
        }
      }

      // UI score class
      let badge = "info", headline = "‚ÑπÔ∏è Informational";
      if (score <= 1) { badge = "ok"; headline = "‚úÖ Looks OK (basic checks)"; }
      else if (score <= 3) { badge = "warn"; headline = "‚ö†Ô∏è Caution (some risk signals)"; }
      else { badge = "bad"; headline = "‚ùå High risk signals"; }

      ssSetScore(score);

      const supplyHuman = supply ? fmtBigintUnits(supply, decimals) : "‚Äî";

      const signalLines = signals.map(s => {
        const icon = (s.level === "good") ? "‚úÖ" : (s.level === "warn" ? "‚ö†Ô∏è" : "‚ùå");
        return `‚Ä¢ ${icon} ${escapeHtml(s.text)}`;
      }).join("<br>");

      // render DEX table
      ssDexTableReset();
      const table = document.getElementById("ss-dex-table");
      ssDexTableShow();
      for (const r of dexResults) table.insertAdjacentHTML("beforeend", ssRowHtml(r));

      // set buttons
      const tokenIn = _ssTokenIn || WBNB;
      ssSetDexButtons(tokenIn, token, dexResults);

      // report object
      const report = {
        scannedAt: new Date().toISOString(),
        chainId: 56,
        rpc: _rpcUrl || "auto",
        requireLiquidity,
        token,
        tokenIn,
        tokenOut: token,
        meta: {
          name,
          symbol,
          decimals,
          totalSupply: supply ? supply.toString() : null
        },
        proxy: {
          eip1967Impl: proxyImpl
        },
        owner: {
          detected: owner,
          renouncedHint: owner ? isRenounced(owner) : null
        },
        pricing: {
          bnbUsd: bnbUsd ? { price: bnbUsd.price, source: bnbUsd.source } : null
        },
        dex: dexResults,
        score,
        signals
      };
      _ssLastReport = report;

      const html = `
        <strong>${headline}</strong><br><br>
        <div class="pill">Token: <span class="mono">${escapeHtml(token)}</span></div>
        <div style="margin-top:10px" class="small">
          <b>Name:</b> ${escapeHtml(name)}<br>
          <b>Symbol:</b> ${escapeHtml(symbol)}<br>
          <b>Decimals:</b> ${escapeHtml(decimals)}<br>
          <b>Total supply:</b> ${escapeHtml(supplyHuman)}<br>
          <b>Owner:</b> ${owner ? `<span class="mono">${escapeHtml(owner)}</span>` : "‚Äî"}<br>
          <b>Proxy:</b> ${proxyImpl ? `<span class="mono">${escapeHtml(proxyImpl)}</span>` : "‚Äî"}
        </div>
        <div style="margin-top:12px" class="small">
          <b>Signals:</b><br>
          ${signalLines}
        </div>
        <div style="margin-top:12px" class="small">
          <b>Next:</b> Open swap only if you trust the token. Consider reading verified source/audits and community signals.
        </div>
      `;

      setStatus(out, badge, html);
      setStatus(status, badge,
        `<strong>Done.</strong> Score: ${score} ‚Ä¢ RequireLiq: ${requireLiquidity ? "ON" : "OFF"} ‚Ä¢ RPC: <span class="mono">${escapeHtml(_rpcUrl || "auto")}</span>`
      );

    } catch (e) {
      console.error(e);
      setStatus(out, "bad", `<strong>‚ùå Scan failed.</strong><br>${escapeHtml((e?.message || e || "Unknown error").toString())}`);
      setStatus(status, "bad", "<strong>‚ùå Scan failed.</strong> Try again or test RPCs below.");
    }
  }

  function ssAutoFromQuery(){
    try {
      const u = new URL(window.location.href);

      // Support: ?token= , ?tokenOut= , ?outputCurrency= , ?inputCurrency=
      const t = u.searchParams.get("token") || u.searchParams.get("tokenOut") || u.searchParams.get("outputCurrency");
      const ti = u.searchParams.get("tokenIn") || u.searchParams.get("inputCurrency");

      const requireLiq = u.searchParams.get("requireLiq");
      if (requireLiq === "1") document.getElementById("ss-require").checked = true;

      if (ti && isHexAddr(ti)) _ssTokenIn = toChecksum(ti);
      if (t && isHexAddr(t)) {
        document.getElementById("ss-token").value = toChecksum(t);
        _ssTokenOut = toChecksum(t);
        ssScan();
      }
    } catch {}
  }

  document.getElementById("ss-scan").addEventListener("click", ssScan);
  document.getElementById("ss-share").addEventListener("click", ssCopyShare);
  document.getElementById("ss-json").addEventListener("click", ssCopyJson);

  // ====== 2) Approvals Guardian (targeted) ======
  let apSigner = null;
  let apOwner = null;

  const ALLOW_ABI = [
    "function allowance(address owner, address spender) view returns (uint256)",
    "function approve(address spender, uint256 value) returns (bool)",
    "function decimals() view returns (uint8)",
    "function symbol() view returns (string)"
  ];

  const MAX_UINT = (1n << 256n) - 1n;

  function apSetStatus(kind, html){
    setStatus(document.getElementById("ap-status"), kind, html);
  }

  function apGetSpender(){
    const preset = document.getElementById("ap-spender-preset").value;
    const input = document.getElementById("ap-spender").value.trim();

    if (preset === "pcs_router") return PCS_ROUTER;
    if (preset === "custom") return input;

    return PCS_ROUTER;
  }

  function apParseTokens(){
    const raw = document.getElementById("ap-tokens").value || "";
    return raw
      .split(/\r?\n/)
      .map(x => x.trim())
      .filter(Boolean)
      .filter(isHexAddr)
      .map(toChecksum);
  }

  function apRenderRows(rows){
    const table = document.getElementById("ap-table");
    const head = table.querySelector(".trow.head");
    table.innerHTML = "";
    table.appendChild(head);

    if (!rows.length) {
      const row = document.createElement("div");
      row.className = "trow";
      row.innerHTML = `<div class="cell muted">‚Äî</div><div class="cell muted">‚Äî</div><div class="cell muted hide-sm">‚Äî</div><div class="cell muted">‚Äî</div>`;
      table.appendChild(row);
      return;
    }

    for (const r of rows) {
      const row = document.createElement("div");
      row.className = "trow";
      const allowanceStr = r.allowanceInf ? "‚àû (infinite)" : r.allowanceHuman;

      row.innerHTML = `
        <div class="cell mono" title="${r.token}">${r.token}</div>
        <div class="cell">${allowanceStr}</div>
        <div class="cell hide-sm">${r.symbol || "‚Äî"}</div>
        <div class="cell">
          <button class="btn btn-ghost" data-token="${r.token}" ${(!r.canRevoke ? "disabled" : "")} style="padding:10px 14px; font-size:12px;">
            Revoke
          </button>
        </div>
      `;
      table.appendChild(row);
    }

    table.querySelectorAll("button[data-token]").forEach((btn) => {
      btn.addEventListener("click", async () => {
        const token = btn.getAttribute("data-token");
        await apRevokeOne(token);
      });
    });
  }

  function getCxModal(){
    return window.cxAppKitModal || null;
  }

  async function apEnsureConnected() {
    const modal = getCxModal();
    if (!modal?.open || !modal?.getWalletProvider) {
      apSetStatus("warn", "<strong>‚ö†Ô∏è Wallet modal not ready yet.</strong><br>Wait a second and try again.");
      return false;
    }

    apSetStatus("info", "<strong>‚è≥ Connecting wallet‚Ä¶</strong>");
    await modal.open({ view: "ConnectWallet" });

    const start = Date.now();
    while (Date.now() - start < 90000) {
      const p = modal.getWalletProvider?.();
      if (p) {
        const bp = new ethers.BrowserProvider(p);
        apSigner = await bp.getSigner();
        apOwner = await apSigner.getAddress();
        document.getElementById("ap-address").textContent = apOwner;
        apSetStatus("ok", "<strong>‚úÖ Wallet connected.</strong>");
        return true;
      }
      await sleep(250);
    }

    apSetStatus("warn", "<strong>‚ö†Ô∏è Connection timeout.</strong><br>Please try again.");
    return false;
  }

  async function apCheck() {
    const ok = apOwner ? true : await apEnsureConnected();
    if (!ok) return;

    const spenderRaw = apGetSpender();
    if (!isHexAddr(spenderRaw)) {
      apSetStatus("bad", "<strong>‚ùå Invalid spender address.</strong>");
      return;
    }
    const spender = toChecksum(spenderRaw);

    const tokens = apParseTokens();
    if (!tokens.length) {
      apSetStatus("warn", "<strong>‚ö†Ô∏è No valid token addresses.</strong><br>Paste at least one token address (one per line).");
      return;
    }

    apSetStatus("info", `<strong>‚è≥ Checking allowances‚Ä¶</strong><br>Owner: <span class="mono">${fmtAddr(apOwner)}</span> ‚Ä¢ Spender: <span class="mono">${fmtAddr(spender)}</span>`);

    const rows = [];
    for (const t of tokens) {
      try {
        const c = new ethers.Contract(t, ALLOW_ABI, apSigner);
        let sym = "‚Äî", dec = 18;
        try { sym = await c.symbol(); } catch {}
        try { dec = Number(await c.decimals()); } catch { dec = 18; }

        const a = BigInt(await c.allowance(apOwner, spender));
        const isInf = (a > (MAX_UINT / 2n));
        const human = isInf ? "‚àû" : (a === 0n ? "0" : fmtBigintUnits(a, dec));

        rows.push({
          token: t,
          symbol: sym,
          allowance: a,
          allowanceInf: isInf,
          allowanceHuman: human,
          canRevoke: (a > 0n)
        });
      } catch {
        rows.push({
          token: t,
          symbol: "‚Äî",
          allowance: 0n,
          allowanceInf: false,
          allowanceHuman: "error",
          canRevoke: false
        });
      }
    }

    apRenderRows(rows);

    const nonZero = rows.filter(r => r.allowance > 0n).length;
    apSetStatus(nonZero ? "warn" : "ok",
      `<strong>Done.</strong><br>Checked ${rows.length} token(s). Non-zero: ${nonZero}.`);
  }

  async function apRevokeOne(tokenAddr) {
    const spenderRaw = apGetSpender();
    if (!apOwner || !apSigner) {
      apSetStatus("warn", "<strong>‚ö†Ô∏è Connect wallet first.</strong>");
      return;
    }
    if (!isHexAddr(spenderRaw)) {
      apSetStatus("bad", "<strong>‚ùå Invalid spender address.</strong>");
      return;
    }
    const spender = toChecksum(spenderRaw);

    const token = toChecksum(tokenAddr);

    apSetStatus("info", `<strong>‚è≥ Revoking‚Ä¶</strong><br>Token: <span class="mono">${fmtAddr(token)}</span> ‚Ä¢ Spender: <span class="mono">${fmtAddr(spender)}</span>`);

    try {
      const c = new ethers.Contract(token, ALLOW_ABI, apSigner);
      const tx = await c.approve(spender, 0);
      apSetStatus("info", `<strong>‚è≥ Pending‚Ä¶</strong><br><span class="mono">${tx.hash}</span>`);
      await tx.wait();
      apSetStatus("ok", "<strong>‚úÖ Revoke successful.</strong>");
      await apCheck();
    } catch (e) {
      console.error(e);
      apSetStatus("bad", `<strong>‚ùå Revoke failed.</strong><br>${escapeHtml((e?.message || e).toString())}`);
    }
  }

  async function apRevokeAllNonZero() {
    const ok = apOwner ? true : await apEnsureConnected();
    if (!ok) return;

    const spenderRaw = apGetSpender();
    if (!isHexAddr(spenderRaw)) {
      apSetStatus("bad", "<strong>‚ùå Invalid spender address.</strong>");
      return;
    }

    const tokens = apParseTokens();
    if (!tokens.length) {
      apSetStatus("warn", "<strong>‚ö†Ô∏è No valid token addresses.</strong>");
      return;
    }

    await apCheck();

    const rows = [];
    document.querySelectorAll("#ap-table button[data-token]").forEach(btn => {
      if (!btn.disabled) rows.push(btn.getAttribute("data-token"));
    });

    if (!rows.length) {
      apSetStatus("ok", "<strong>‚úÖ Nothing to revoke.</strong>");
      return;
    }

    apSetStatus("warn", `<strong>‚è≥ Revoking ${rows.length} token(s)‚Ä¶</strong><br>This will send multiple transactions.`);

    for (const t of rows) {
      await apRevokeOne(t);
      await sleep(500);
    }

    apSetStatus("ok", "<strong>‚úÖ Revoke batch finished.</strong>");
  }

  document.getElementById("ap-spender-preset").addEventListener("change", () => {
    const preset = document.getElementById("ap-spender-preset").value;
    const input = document.getElementById("ap-spender");
    if (preset === "pcs_router") {
      input.value = PCS_ROUTER;
      input.disabled = true;
    } else {
      input.value = "";
      input.disabled = false;
    }
  });
  document.getElementById("ap-spender").value = PCS_ROUTER;
  document.getElementById("ap-spender").disabled = true;

  document.getElementById("ap-connect").addEventListener("click", apEnsureConnected);
  document.getElementById("ap-check").addEventListener("click", apCheck);
  document.getElementById("ap-revoke-all").addEventListener("click", apRevokeAllNonZero);

  // ====== 3) DEX Guard Bookmarklet (advanced tokenIn/tokenOut) ======
  function buildThisPageBase(){
    const u = new URL(window.location.href);
    u.search = "";
    u.hash = "";
    return u.toString();
  }

  const bookmarklet = `javascript:(function(){try{
    var u=new URL(location.href);
    var inC=u.searchParams.get('inputCurrency')||u.searchParams.get('tokenIn')||'';
    var outC=u.searchParams.get('outputCurrency')||u.searchParams.get('tokenOut')||u.searchParams.get('token')||u.searchParams.get('address')||'';
    if(!outC){ outC=prompt('Paste token OUT (BSC):'); }
    if(!outC){ return; }
    if(!inC){ inC='${WBNB}'; }
    var dest='${buildThisPageBase()}?token='+encodeURIComponent(outC.trim())
      +'&tokenIn='+encodeURIComponent(inC.trim())
      +'&tokenOut='+encodeURIComponent(outC.trim());
    window.open(dest,'_blank');
  }catch(e){ alert('DEX Guard error: '+e.message); }})();`;

  const bmLink = document.getElementById("bm-link");
  const bmCode = document.getElementById("bm-code");
  bmLink.href = bookmarklet;
  bmCode.value = bookmarklet;

  // ====== 4) RPC Checker ======
  let _bestRpc = "";

  function rpcRow(url, latency, block, ok){
    const table = document.getElementById("rpc-table");
    const row = document.createElement("div");
    row.className = "trow";

    const tag = ok ? "‚úÖ OK" : "‚ùå Fail";
    const lat = ok ? (latency.toFixed(0) + " ms") : "‚Äî";
    const blockStr = ok ? String(block) : "‚Äî";

    row.innerHTML = `
      <div class="cell mono" title="${escapeHtml(url)}">${escapeHtml(url)}</div>
      <div class="cell">${escapeHtml(lat)}</div>
      <div class="cell hide-sm">${escapeHtml(blockStr)}</div>
      <div class="cell">${escapeHtml(tag)}</div>
    `;

    if (ok && url === _bestRpc) {
      row.style.background = "rgba(0,230,118,0.10)";
      row.style.borderTopColor = "rgba(0,230,118,0.20)";
    }

    table.appendChild(row);
  }

  async function rpcTestAll(){
    const status = document.getElementById("rpc-status");
    const custom = (document.getElementById("rpc-custom").value || "").trim();

    const list = [...RPCS_DEFAULT];
    if (custom) list.unshift(custom);

    const table = document.getElementById("rpc-table");
    table.innerHTML = `
      <div class="trow head">
        <div class="cell">RPC</div>
        <div class="cell">Latency</div>
        <div class="cell hide-sm">Block</div>
        <div class="cell">Status</div>
      </div>
    `;

    setStatus(status, "info", `<strong>‚è≥ Testing ${list.length} RPC(s)‚Ä¶</strong>`);
    _bestRpc = "";
    let bestMs = Infinity;

    for (const url of list) {
      let ok = false;
      let ms = 0;
      let block = 0;

      try {
        const p = new ethers.JsonRpcProvider(url);
        const t0 = performance.now();
        block = await withTimeout(p.getBlockNumber(), 7000, "rpc blockNumber");
        const net = await withTimeout(p.getNetwork(), 7000, "rpc network");
        const t1 = performance.now();
        ms = (t1 - t0);

        if (Number(net.chainId) !== 56) throw new Error("Wrong chainId");
        ok = true;

        if (ms < bestMs) {
          bestMs = ms;
          _bestRpc = url;
        }
      } catch {
        ok = false;
      }

      rpcRow(url, ms, block, ok);
      await sleep(120);
    }

    if (_bestRpc) {
      setStatus(status, "ok", `<strong>‚úÖ Best RPC:</strong> <span class="mono">${escapeHtml(_bestRpc)}</span>`);
    } else {
      setStatus(status, "bad", "<strong>‚ùå All RPC tests failed.</strong><br>Try a different custom RPC.");
    }
  }

  async function rpcCopyBest(){
    const status = document.getElementById("rpc-status");
    if (!_bestRpc) {
      setStatus(status, "warn", "<strong>‚ö†Ô∏è No best RPC yet.</strong><br>Run Test RPCs first.");
      return;
    }
    await copyText(_bestRpc);
    setStatus(status, "ok", `<strong>‚úÖ Copied:</strong> <span class="mono">${escapeHtml(_bestRpc)}</span>`);
  }

  document.getElementById("rpc-test").addEventListener("click", rpcTestAll);
  document.getElementById("rpc-copy-best").addEventListener("click", rpcCopyBest);

  // ====== Top connect button + quick scan ======
  document.getElementById("btn-run-all").addEventListener("click", async () => {
    await ssScan();
    await rpcTestAll();
  });

  document.getElementById("btn-connect").addEventListener("click", apEnsureConnected);

  // ====== init ======
  ssAutoFromQuery();
</script>


  <!-- AppKit (wallet list) -->
  <script type="module">
  import { createAppKit } from "https://esm.sh/@reown/appkit@1.8.15";
  import { EthersAdapter } from "https://esm.sh/@reown/appkit-adapter-ethers@1.8.15";
  import { bsc } from "https://esm.sh/@reown/appkit/networks";

  const projectId = "7886bcb95105e9e47337cec481d5de75";

  const modal = createAppKit({
    adapters: [new EthersAdapter()],
    networks: [bsc],
    defaultNetwork: bsc,
    projectId,
    analytics: false,
    metadata: {
      name: "CycleX",
      description: "CycleX Security Hub",
      url: window.location.origin,
      icons: [`${window.location.origin}/logo.png`]
    }
  });

  // IMPORTANT: expose via window (module scope can't write to non-module `let`)
  window.cxAppKitModal = modal;
</script>

</body>
</html>
